machine:
  services:
    - docker

dependencies:
  # Note, we used to use the naive caching of docker images, but found that it was quicker
  # just to pull each time. #rollondockercaching
  override:
    - docker pull phusion/holy-build-box-64:latest
    - docker pull phusion/holy-build-box-32:latest
#    - docker pull pelson/obvious-ci:latest_x64
#    - docker pull pelson/conda32_obvious_ci

test:
  override:
    - echo $CIRCLE_PR_NUMBER
    - echo $CIRCLE_BRANCH
    - if [[ -z "$CIRCLE_PR_NUMBER" && "$CIRCLE_BRANCH" == "declare_build" ]]; then export UPLOAD=true; else export UPLOAD=false; fi
    - echo $UPLOAD

    - docker run -e TOKEN -e UPLOAD -i -v `pwd`:/io phusion/holy-build-box-64:latest
      bash /io/.ci_support/docker-build-64.sh;
    - docker run -e TOKEN -e UPLOAD -i -v `pwd`:/io phusion/holy-build-box-32:latest
      linux32 bash /io/.ci_support/docker-build-32.sh;
